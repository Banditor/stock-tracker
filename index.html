<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>מעקב מניות</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2, h3 {
      text-align: center;
    }
    form {
      margin-bottom: 20px;
      text-align: center;
    }
    input[type="text"] {
      padding: 5px;
      width: 200px;
      font-size: 16px;
    }
    button {
      padding: 5px 10px;
      font-size: 16px;
      margin-left: 5px;
    }
    .stock-list {
      list-style: none;
      padding: 0;
      text-align: center;
    }
    .stock-list li {
      margin: 5px 0;
    }
    .stock-list a {
      text-decoration: none;
      color: #007acc;
      font-weight: bold;
    }
    .columns {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    .column {
      flex: 1;
      min-width: 300px;
      border: 1px solid #ccc;
      padding: 10px;
      background: #fafafa;
    }
    .news-item, .fund-item {
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
      padding-bottom: 5px;
    }
    .back-button {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- עמוד ראשי: הוספת מניות לרשימה -->
    <div id="main-page" style="display:none;">
      <h1>מעקב מניות</h1>
      <form id="add-stock-form">
        <label for="stock-symbol">הוסף מניה (סימול): </label>
        <input type="text" id="stock-symbol" required>
        <button type="submit">הוסף</button>
      </form>
      <ul id="stock-list" class="stock-list"></ul>
      <button id="save-button">שמור עדכון ל-GitHub</button>
    </div>
    
    <!-- עמוד פרטים: מידע בסיסי, חדשות על מבנה מניות, מידע על קרנות -->
    <div id="stock-details" style="display:none;">
      <button id="back-button" class="back-button">← חזור לרשימה</button>
      <h2 id="stock-title">מידע על מניה</h2>
      <div id="basic-info">
        <p>מספר מניות כולל: <span id="total-shares"></span></p>
        <p>שווי שוק: <span id="market-cap"></span></p>
        <p>מספר מניות זמינות: <span id="available-shares"></span></p>
      </div>
      <div class="columns">
        <div class="column" id="news-column">
          <h3>חדשות - עדכונים במבנה המניות</h3>
          <div id="news-list"></div>
        </div>
        <div class="column" id="funds-column">
          <h3>מידע על קרנות ופעולות אחרונות</h3>
          <div id="funds-list"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // מפתח לאחסון רשימת המניות בדפדפן (localStorage)
    const STOCK_LIST_KEY = 'stockList';

    // פונקציות לדמו (יש להחליף בקריאות API אמיתיות)
    function fetchBasicStockInfo(symbol) {
      // קריאה ל-API לקבלת מידע בסיסי על המניה
      return new Promise(resolve => {
        // נתונים לדוגמא
        resolve({
          totalShares: 50000000,
          marketCap: 1000000000,
          availableShares: 30000000
        });
      });
    }

    function fetchNewsUpdates(symbol) {
      // קריאה ל-API לקבלת חדשות בנוגע לעדכונים במבנה המניות (דילול, בייבאק, מענקי מניות לעובדים)
      return new Promise(resolve => {
        // נתונים לדוגמא
        resolve([
          { date: '2025-01-15', headline: 'חברת ' + symbol + ' הודיעה על דילול', details: 'פרטים נוספים על הדילול והתהליכים.' },
          { date: '2025-02-01', headline: 'בייבאק: ' + symbol + ' רכשה מניות משוק', details: 'פרטים על תהליך הבייבאק והשפעותיו.' }
        ]);
      });
    }

    function fetchFundHoldings(symbol) {
      // קריאה ל-API לקבלת מידע על קרנות שמחזיקות במניה והפעולות האחרונות
      return new Promise(resolve => {
        // נתונים לדוגמא
        resolve([
          { 
            fund: 'ARKK', 
            currentHolding: { shares: 19400000, marketValue: 150000000 },
            actions: [
              { date: '2025-01-10', shares: 1830000, marketValue: 14500000 },
              { date: '2025-01-08', shares: 4700000, marketValue: 37000000 }
              // ניתן להוסיף עד 10 פעולות
            ]
          },
          { 
            fund: 'ARKG', 
            currentHolding: { shares: 336653, marketValue: 2700000 },
            actions: [
              { date: '2025-01-03', shares: 336653, marketValue: 2700000 }
              // ניתן להוסיף פעולות נוספות
            ]
          }
        ]);
      });
    }

    // פונקציה לשמירת רשימת מניות למאגר GitHub באמצעות GitHub API
    function saveStockListToGitHub(stockList) {
      // עדכנו את הפרטים הבאים בהתאם לחשבון ולמאגר שלכם
      const username = 'YOUR_GITHUB_USERNAME';
      const repo = 'YOUR_REPO';
      const filePath = 'stockList.json';
      const token = 'YOUR_GITHUB_PERSONAL_ACCESS_TOKEN';

      // ראשית, נבדוק אם הקובץ כבר קיים במאגר לקבלת ה-sha שלו
      fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
        headers: {
          'Authorization': 'token ' + token
        }
      })
      .then(response => response.json())
      .then(data => {
        let sha = data.sha;
        let content = btoa(JSON.stringify(stockList, null, 2));
        const commitMessage = 'Update stock list';
        const body = {
          message: commitMessage,
          content: content,
          sha: sha
        };

        return fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'token ' + token
          },
          body: JSON.stringify(body)
        });
      })
      .then(response => response.json())
      .then(result => {
        alert('רשימת המניות נשמרה בהצלחה ב-GitHub!');
      })
      .catch(error => {
        console.error('שגיאה בשמירה ל-GitHub:', error);
        alert('שגיאה בשמירה ל-GitHub. בדקו את הקונסול לפרטים.');
      });
    }

    // פונקציות לניהול רשימת המניות ב-localStorage
    function getStockList() {
      let list = localStorage.getItem(STOCK_LIST_KEY);
      return list ? JSON.parse(list) : [];
    }

    function setStockList(list) {
      localStorage.setItem(STOCK_LIST_KEY, JSON.stringify(list));
    }

    // לוגיקת האפליקציה הראשית
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const symbolParam = urlParams.get('symbol');
      
      if (symbolParam) {
        // אם יש פרמטר סימול, מציגים את דף הפרטים
        document.getElementById('stock-details').style.display = 'block';
        document.getElementById('main-page').style.display = 'none';
        loadStockDetails(symbolParam);
      } else {
        // מציגים את דף הראשי
        document.getElementById('main-page').style.display = 'block';
        document.getElementById('stock-details').style.display = 'none';
        loadStockList();
      }

      // טיפול בהוספת מניה דרך הטופס
      document.getElementById('add-stock-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const symbolInput = document.getElementById('stock-symbol');
        const symbol = symbolInput.value.trim().toUpperCase();
        if (symbol) {
          let stockList = getStockList();
          // בדיקה למניעת הוספת כפילויות
          if (!stockList.includes(symbol)) {
            stockList.push(symbol);
            setStockList(stockList);
            loadStockList();
          }
          symbolInput.value = '';
        }
      });

      // כפתור לשמירה ל-GitHub
      document.getElementById('save-button').addEventListener('click', function() {
        const stockList = getStockList();
        saveStockListToGitHub(stockList);
      });

      // כפתור חזרה מדף הפרטים לרשימה
      document.getElementById('back-button').addEventListener('click', function() {
        window.location.href = window.location.pathname;
      });
    });

    // פונקציה לטעינת רשימת המניות בעמוד הראשי
    function loadStockList() {
      const stockList = getStockList();
      const listEl = document.getElementById('stock-list');
      listEl.innerHTML = '';
      stockList.forEach(symbol => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = window.location.pathname + '?symbol=' + symbol;
        link.textContent = symbol;
        li.appendChild(link);
        listEl.appendChild(li);
      });
    }

    // פונקציה לטעינת פרטי מניה והצגת המידע בדף הפרטים
    function loadStockDetails(symbol) {
      document.getElementById('stock-title').textContent = 'מידע על מניה: ' + symbol;
      
      // טעינת מידע בסיסי על המניה
      fetchBasicStockInfo(symbol).then(info => {
        document.getElementById('total-shares').textContent = info.totalShares.toLocaleString();
        document.getElementById('market-cap').textContent = info.marketCap.toLocaleString() + ' $';
        document.getElementById('available-shares').textContent = info.availableShares.toLocaleString();
      });

      // טעינת חדשות על עדכונים במבנה המניות
      fetchNewsUpdates(symbol).then(news => {
        const newsListEl = document.getElementById('news-list');
        newsListEl.innerHTML = '';
        news.forEach(item => {
          const div = document.createElement('div');
          div.className = 'news-item';
          div.innerHTML = '<strong>' + item.date + ':</strong> ' + item.headline + '<br>' + item.details;
          newsListEl.appendChild(div);
        });
      });

      // טעינת מידע על קרנות והפעולות האחרונות
      fetchFundHoldings(symbol).then(funds => {
        const fundsListEl = document.getElementById('funds-list');
        fundsListEl.innerHTML = '';
        funds.forEach(fund => {
          const div = document.createElement('div');
          div.className = 'fund-item';
          let html = '<strong>קרן: ' + fund.fund + '</strong><br>';
          html += 'אחזקה נוכחית: ' + fund.currentHolding.shares.toLocaleString() + ' מניות, שווי: ' + fund.currentHolding.marketValue.toLocaleString() + ' $<br>';
          html += '<em>פעולות אחרונות:</em><br>';
          html += '<ul>';
          fund.actions.forEach(action => {
            html += '<li>' + action.date + ': ' + action.shares.toLocaleString() + ' מניות, שווי: ' + action.marketValue.toLocaleString() + ' $</li>';
          });
          html += '</ul>';
          div.innerHTML = html;
          fundsListEl.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>
